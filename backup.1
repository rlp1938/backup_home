.TH "BACKUP" 1 "2015-01-15" "Robert L Parker rlp1938@gmail.com"


.SH NAME

.P
\fBbackup\fR \- A program to backup the invoking user's home directory by
running \fBrsync\fR.

.SH SYNOPSIS

.P
\fBbackup\fR \- requires no arguments and no options.

.SH DESCRIPTION

.P
\fBbackup\fR \- determines the source and destination paths from
information recorded in configuration files located in
\fI$HOME/.config/backup/\fR. The destination is to be in a removable
device connected via USB or other suitable technology. Generally
speaking \fBbackup\fR is \fBcron\fR safe regardless of whether \fBcron\fR has
an available MTA or not. But see \fBFIRSTRUN\fR below for an exception.

.P
NB this program is intended to be run by \fBcron\fR at frequent intervals.
Accordingly \fBrsync\fR is run without using the \fB\-\-del\fR option. But it
is run a second time using both
\fB--del\fR and \fB--dry-run\fR
options and logged separately to the main log. See \fBFILES\fR below for
more detail.

.SH FIRSTRUN

.P
There are 3 configuration files that must be installed for \fBbackup\fR
and associated utilities to function. These are \fIbackup.cfg\fR,
\fIexcludes\fR and \fIcruft\fR.
The destination dir for these files is \fI$HOME/.config/backup\fR.
So the expectation is that the first time you run \fBbackup\fR the config
files will be installed and you will edit them to ensure that they meet
your needs. The program expects that the original files will be
installed at \fI/usr/local/share/backup/\fR. If you have used some other
$PREFIX at the configuration stage of the build you will need to copy
these files yourself to the required location. See \fBFILES\fR for a
detailed description of the files that \fBbackup\fR uses and generates.

.SH FILES

.P
\fIbackup.cfg\fR names the backup device eg \fI/dev/sdb/\fR without the
partition number, and the name of the backup directory. You may use more
than one backup set, and may have them with several partitions. The
program will find the named backup dir if the device is mounted, or
record an error if not.

.P
\fIexcludes\fR is to contain a list of what you do not want to be backed
up. The items are to be listed in a way understood by \fBrsync\fR.

.P
\fIcruft\fR More than 90% of backup activity is generated by programs like
browsers writing and deleting cache and config files. This generates a
huge amount of data that may mask events that need to be seen by the
user. \fBdecruft\fR is run using a logfile as it's argument and it lists
the content of that logfile on \fIstdout\fR but it excludes those items that match regular expressions recorded in \fIcruft\fR. These regexes are
to be in \fBegrep\fR format. See \fBEXAMPLES\fR below.

.P
\fI$HOME/lock/backup.lock\fR A zero length file to guard against multiple
versions of \fBbackup\fR running. The file is removed when \fBbackup\fR
completes.

.P
\fI$HOME/log/backup.log\fR The main log file. If viewed when \fBbackup\fR is
running you may see lines beginning with 'deleting'. These are produced
by the second run of \fBrsync\fR and will be removed when \fBbackup\fR
finishes. This log file grows continually until \fBbulogrot\fR is run.

.P
\fI$HOME/log/dryrun.log\fR This file is created new at the end of every
run of \fBbackup\fR. Because lines beginning with 'deleting' will be
generated on every run there is no point in appending this file.

.P
\fI$HOME/log/errors.log\fR This file captures everything written to
\fIstderr\fR. Generally it will record events such as the backup drive
not mounted or that an instance of backup is already running.

.P
\fI$HOME/log/backup.log.0\fR .. \fIbackup.log.7\fR generated by \fBbulogrot\fR
\&. \fIbackup.log.7\fR is discarded on each run of \fBbulogrot\fR.

.P
\fI$HOME/log/errors.log.0\fR .. \fIerrors.log.7\fR generated by \fBbulogrot\fR
\&. \fIerrors.log.7\fR is discarded on each run of \fBbulogrot\fR.

.SH EXAMPLES

.P
decruft ~/log/dryrun.log |grep '^deleting' |less

.P
decruft ~/log/backup.log |less

.P
cleanup

.P
backup

.P
bulogrot

.SH SEE ALSO

.P
\fBbulogrot\fR (1), \fBcleanup\fR (1), \fBdecruft\fR (1)

.\" man code generated by txt2tags 2.6 (http://txt2tags.org)
.\" cmdline: txt2tags -t man backup.t2t
